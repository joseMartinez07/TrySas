/*LIBRERIAS*/
LIBNAME RUTAH1 '/home/u63720089/MI_LIB_TRYPRU';
LIBNAME RUTAH2 '/home/u63720089/MI_LIB_TRYPRU';

/*proc import para la tabla 1*/
PROC IMPORT
	OUT= RUTAH1.SEDE_COLE
	DATAFILE= '/home/u63720089/Trypru/Base .xlsx'
	DBMS=xlsx
	REPLACE;
	SHEET='Hoja1';
	GETNAMES=yes
;RUN;

/*proc import para la tabla 2*/
PROC IMPORT
	OUT= RUTAH2.DATA_STU
	DATAFILE= '/home/u63720089/Trypru/Base .xlsx'
	DBMS=xlsx
	REPLACE;
	SHEET='Hoja2';
	GETNAMES=yes
;RUN;

/*TABLA DE CONTEO DE SEDES*/
PROC SQL;
	SELECT A.SEDE, COUNT(DISTINCT(A.DOC)) AS CANTIDAD_DE_ESTUDIANTES
	FROM RUTAH1.SEDE_COLE A
	INNER JOIN RUTAH2.DATA_STU B
	ON A.DOC = B.DOC
	GROUP BY A.SEDE
;QUIT;

/*TABLA DE ESTUDIANTES RETIRADOS*/
PROC SQL;
	SELECT DISTINCT(A.NOMBRE1||' '||A.NOMBRE2||' '||A.APELLIDO1||' '||A.APELLIDO2) AS NOMBRE_Y_APELLIDO_DEL_ESTUDIANTE,
			CASE
				WHEN A.DOCUMENT_TIP EQ 1 THEN 'RC'
				WHEN A.DOCUMENT_TIP EQ 2 THEN 'TI'
				WHEN A.DOCUMENT_TIP EQ 3 THEN 'NES'
				WHEN A.DOCUMENT_TIP EQ 4 THEN 'NUIP'
				ELSE 'OTHER'
			END AS TIPO_DE_DOCUMENTO,
			B.DOC AS DOCUMENT,
			B.SEDE AS SEDE,
			B.ESTADO AS ESTADO,
			B.FECHAFIN AS FECHA_RETIRO
	FROM RUTAH2.DATA_STU A
	LEFT JOIN RUTAH1.SEDE_COLE B
	ON A.DOC = B.DOC
	WHERE B.ESTADO = 'RETIRADO'
	ORDER BY NOMBRE_Y_APELLIDO_DEL_ESTUDIANTE ASC
;QUIT;

/*TABLA ESTUDIANTES MATRICULADOS*/
PROC SQL;
	SELECT DISTINCT(B.NOMBRE1||' '||B.NOMBRE2||' '||B.APELLIDO1||' '||B.APELLIDO2) AS ESTUDIANTE,
		CASE 
			WHEN B.DOCUMENT_TIP EQ 1 THEN 'RC'
			WHEN B.DOCUMENT_TIP EQ 2 THEN 'TI'
			WHEN B.DOCUMENT_TIP EQ 3 THEN 'NES'
			WHEN B.DOCUMENT_TIP EQ 4 THEN 'NUIP'
			ELSE 'OTHER'
		END AS TIPO_DE_DOCUMENTO,
		A.DOC AS DOCUMENTO,
		A.GRADO_COD AS GRADO_COD,
		A.SEDE AS SEDE,
		B.JORNADA AS JORNADA,
		CASE
			WHEN B.INTERNADO IS NULL THEN 'VACIO'
			ELSE B.INTERNADO
		END AS INTERNADO
	FROM RUTAH1.SEDE_COLE A
	INNER JOIN RUTAH2.DATA_STU B
	ON A.DOC = B.DOC
	ORDER BY A.ESTADO = 'MATRICULADO'
;QUIT;


PROC SQL;
	SELECT DISTINCT(B.H) AS TIPO, B.DOCUMENT_TIP
	FROM RUTAH2.DATA_STU B
	ORDER BY B.DOCUMENT_TIP
;QUIT;